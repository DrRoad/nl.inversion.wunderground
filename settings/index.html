<!doctype html>
<html>
<head>

</head>
<body>

<h1 data-i18n="settings.app.title"></h1>
<p data-i18n="settings.app.description"></p>

<form id="locationform">
    <fieldset id="wundergroundSet">
        <legend>
        <label data-i18n="settings.app.wunderground.wunderground_title"></label>
        </legend>
        <div class="field row">
            <label class="form_label" for="wundergroundKey" data-i18n="settings.app.wunderground.key"></label>
            <br>
            <input class="form_input" id="wundergroundKey" type="text" value="123456abcdef"/>
        </div>
    </fieldset>
    
    <fieldset id="location">
        <legend>
        <label data-i18n="settings.app.location.location"></label>
        </legend>

        <p>
        <div class="field">
            <input class="checkbox" id="autolocation" type="checkbox" checked="true"
                onchange="locationform.locationfields.disabled = checked">
            <label class="form_label" for="autolocation" data-i18n="settings.app.location.autolocation"></label>
        </div>
        </p>

        <fieldset id="locationfields">    
            <legend>
            <label data-i18n="settings.app.location.manualLocation_label"></label>
            </legend>
            
            <p data-i18n="settings.app.location.manualLocation_explanation"></p>
            
            <div class="field row">
                <label class="form_label" for="country" data-i18n="settings.app.location.country"></label>
                <br>
                <input class="form_input" id="country" type="text" value="Netherlands"/><br><br>
            </div>

            <div class="field row">
                <label class="form_label" for="city" data-i18n="settings.app.location.city"></label>
                <br>
                <input class="form_input" input id="city" type="text" value="Amsterdam"/><br><br>
            </div>
            
            <p data-i18n="settings.app.location.updateFrequenty_explanation"></p>

            <div class="field row">
                <label  class="form_label" for="updateFrequenty" data-i18n="settings.app.location.update_frequenty"></label>
                <br>
                <input class="form_input"  id="updateFrequenty" type="number" value="60"/><br><br>
            </div>
        </fieldset>
    </fieldset>
</form>

<button class="right" id="saver" onclick="save()" data-i18n="settings.app.button.save"></button>

<script type="text/javascript">

    function onHomeyReady(){
        Homey.get('country', function(err, country) {
            if (err) {
                console.error(err)
            } else {
                document.getElementById('country').value = country
            }
        })

        Homey.get('city', function(err, city) {
            if (err) {
                console.error(err)
            } else {
                document.getElementById('city').value = city
            }
        })

        Homey.get('updateFrequenty', function(err, updateFrequenty) {
            if (err) {
                console.error(err)
            } else {
                document.getElementById('updateFrequenty').value = updateFrequenty
            }
        })

        Homey.get('autolocation', function(err, autolocation) {
            if (err) {
                console.error(err)
            } else {
                document.getElementById('autolocation').checked = autolocation
                document.getElementById('locationfields').disabled = autolocation
            }
        })
        
        Homey.get('wundergroundKey', function(err, wundergroundKey) {
            if (err) {
                Homey.error(err)
            } else {
                document.getElementById('wundergroundKey').value = wundergroundKey
            }
        })

        Homey.ready()
    }
    
    function save() {
        Homey.set('country', document.getElementById('country').value);
        Homey.set('city', document.getElementById('city').value);
        Homey.set('updateFrequenty', document.getElementById('updateFrequenty').value);
        Homey.set('autolocation', document.getElementById('autolocation').checked);
        Homey.set('wundergroundKey', document.getElementById('wundergroundKey').value);
    }
</script>

</body>
</html>